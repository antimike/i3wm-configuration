#!/bin/bash

# Media player menu with rofi

mediaplayer=$1
choice=$(
    {
        # Available actions
        while read icon description
        do
          printf "$description\00icon\37$icon\n"
        done <<EOF
go-previous               Previous track
media-playback-start      Play
media-playback-pause      Pause
media-playback-stop       Stop
go-next                   Next track
multimedia-volume-control Open mixer panel
com.spotify.Client        Open ${mediaplayer^}
EOF

        # Player status
        status=$(playerctl -p $mediaplayer status)
        case $status in
            Playing|Paused)
                title="$(playerctl -p $mediaplayer metadata xesam:title)"
                artist="$(playerctl -p $mediaplayer metadata xesam:artist)"
                status="$status <span weight='light'><i>${title} (${artist})</i></span>"
                ;;
        esac
        printf "\00message\x1f${status}\n"
    } | rofi -dmenu -show-icons -no-custom -i -p "media player action" -format d -async-pre-read 0 -mesg "..." \
             -kb-select-1 Super+z \
             -kb-select-2 Super+x \
             -kb-select-3 Super+c \
             -kb-select-4 Super+v \
             -kb-select-5 Super+b \
             -kb-select-6 Super+m \
             -kb-select-7 Super+s
      )
case $choice in
    1) xdotool key --clearmodifiers XF86AudioPrev ;;
    2) xdotool key --clearmodifiers XF86AudioPlay ;;
    3) xdotool key --clearmodifiers XF86AudioPause ;;
    4) xdotool key --clearmodifiers XF86AudioStop ;;
    5) xdotool key --clearmodifiers XF86AudioNext ;;
    6) i3-msg '[class="Pavucontrol"] focus' || i3-msg exec exec pavucontrol ;;
    7) i3-msg '[class="'${mediaplayer^}'"] focus' || i3-msg exec exec spotify ;;
esac
